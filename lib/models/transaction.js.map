{
  "version": 3,
  "sources": [
    "transaction.js"
  ],
  "names": [
    "R",
    "require",
    "RA",
    "Moment",
    "Entry",
    "Credit",
    "Debit",
    "utils",
    "makeError",
    "calcHashId",
    "CREDIT",
    "DEBIT",
    "ERRORS",
    "SYMBOL_MAP",
    "makeFees",
    "fees",
    "DEFAULT_PROPS",
    "id",
    "account",
    "credit",
    "debit",
    "status",
    "party",
    "address",
    "utc",
    "note",
    "tags",
    "entries",
    "debits",
    "credits",
    "trades",
    "details",
    "KEYS",
    "keysIn",
    "getProps",
    "pick",
    "allBalanced",
    "all",
    "e",
    "isBalanced",
    "getDebits",
    "filter",
    "propEq",
    "getCredits",
    "pairToObject",
    "pair",
    "obj",
    "forEach",
    "entry",
    "type",
    "toLowerCase",
    "Transaction",
    "constructor",
    "props",
    "merged",
    "merge",
    "has",
    "isString",
    "key",
    "console",
    "error",
    "JSON",
    "stringify",
    "TypeError",
    "INVALID_TERM",
    "makeEntries",
    "addEntryPair",
    "push",
    "makeBalancedPairs",
    "makeTrades",
    "toObject",
    "makeTransactions",
    "raw",
    "map",
    "tx",
    "applyToAccounts",
    "accounts",
    "applyToAccount",
    "fn",
    "getAccounts",
    "Set",
    "getAccountPath",
    "getCurrencies",
    "prop",
    "getTradePairs",
    "isTrade",
    "makeBalancedPair",
    "shortcut",
    "isCredit",
    "leadingSymbolMap",
    "tokens",
    "tokenizeShortcut",
    "accountShortcut",
    "join",
    "noAccountShortcut",
    "slice",
    "transaction",
    "setPair",
    "rawArray",
    "shortcutToEntries",
    "length",
    "size",
    "options",
    "stripFalsy",
    "byDay",
    "format",
    "toISOString",
    "t",
    "toString",
    "toYaml",
    "data",
    "work",
    "prefix",
    "val",
    "getFullShortcut",
    "Error",
    "tag",
    "module",
    "exports"
  ],
  "mappings": "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",
  "file": "transaction.js",
  "sourceRoot": "../../src/models",
  "sourcesContent": [
    "/* eslint no-console: [\"error\", { allow: [\"error\"] }] */\nconst R = require('ramda');\nconst RA = require('ramda-adjunct');\nconst Moment = require('moment');\nconst Entry = require('./entry');\nconst Credit = require('./credit');\nconst Debit = require('./debit');\nconst utils = require('../utils/models');\nconst { makeError } = require('../utils/errors');\nconst { calcHashId } = require('../utils/numbers');\nconst { CREDIT, DEBIT, ERRORS, SYMBOL_MAP } = require('./constants');\n\n// stub out fee descriptors\nconst makeFees = fees => fees;\n\nconst DEFAULT_PROPS = {\n  id: '',\n  account: { credit: '', debit: '' },\n  status: '',\n  party: '',\n  address: '',\n  utc: '',\n  note: '',\n  fees: [],\n  tags: [],\n  entries: [],\n  debits: [],\n  credits: [],\n  trades: [],\n  details: {},\n};\n\nconst KEYS = R.keysIn(DEFAULT_PROPS);\n\nconst getProps = R.pick(KEYS);\nconst allBalanced = R.all(e => e.isBalanced());\nconst getDebits = R.filter(R.propEq('type', DEBIT));\nconst getCredits = R.filter(R.propEq('type', CREDIT));\nconst pairToObject = (pair) => {\n  const obj = {};\n  pair.forEach((entry) => {\n    obj[entry.type.toLowerCase()] = entry;\n  });\n  return obj;\n};\n\nclass Transaction {\n  /**\n   * Construct using a `props` object that must include \"utc\", and may also\n   * include \"notes\", \"tags\", and a list of transactions\n   * @param {object} props\n   */\n  constructor(props = {}) {\n    const merged = R.merge(DEFAULT_PROPS, getProps(props));\n    const { trades, debits, credits, entries, fees } = merged;\n\n    if (R.has('account', merged) && RA.isString(merged.account)) {\n      merged.account = { credit: merged.account, debit: merged.account };\n    }\n\n    KEYS.forEach((key) => {\n      if (key !== 'debits' && key !== 'credits' && key !== 'entries') {\n        this[key] = merged[key];\n      }\n    });\n\n    if (!this.utc) {\n      console.error(`Invalid Transaction, must have a 'utc', got: ${JSON.stringify(props)}`);\n      throw makeError(\n        TypeError,\n        ERRORS.INVALID_TERM,\n        'Invalid Transaction, must have a utc'\n      );\n    }\n    this.utc = Moment(this.utc);\n\n    // TODO: remove\n    this.entries = Entry.makeEntries(entries, this);\n\n    const addEntryPair = (pair) => {\n      this.entries.push(pair.credit);\n      this.entries.push(pair.debit);\n    };\n\n    if (credits) {\n      this.makeBalancedPairs(credits, true).forEach(addEntryPair);\n    }\n    if (debits) {\n      this.makeBalancedPairs(debits, false).forEach(addEntryPair);\n    }\n    if (trades) {\n      this.makeTrades(trades).forEach(addEntryPair);\n    }\n    this.fees = makeFees(fees);\n    if (!this.id) {\n      this.id = calcHashId(this.toObject());\n    }\n  }\n\n  /**\n   * Create transactions from a raw list\n   * @param {Array<Object>} raw transaction objections\n   * @return {Array<Transaction>} transactions\n   */\n  static makeTransactions(raw) {\n    return raw.map(tx => new Transaction(tx));\n  }\n\n  /**\n   * Applies all entries to their correct accounts.\n   * @param {Accounts} accounts\n   * @return {Transaction} this transaction\n   */\n  applyToAccounts(accounts) {\n    this.entries.forEach(e => e.applyToAccount(accounts));\n    return this;\n  }\n\n  /**\n   * Apply a function to all entries.\n   * @param {Function} function to apply\n   */\n  forEach(fn) {\n    if (fn) {\n      this.entries.forEach(fn);\n    }\n  }\n\n  getAccounts() {\n    return new Set(this.map(e => e.getAccountPath()));\n  }\n\n  /**\n   * Get all credits from this transaction entries\n   * @return {Array<Entry} Credits\n   */\n  getCredits() {\n    return getCredits(this.entries);\n  }\n\n  /**\n   * Get the set of all currencies used in this transaction\n   */\n  getCurrencies() {\n    return new Set(this.map(R.prop('currency')));\n  }\n\n  /**\n   * Get all debits from this transaction entries\n   * @return {Array<Entry} Debits\n   */\n  getDebits() {\n    return getDebits(this.entries);\n  }\n\n  /**\n   * Get all trade pairs from entries.\n   */\n  getTradePairs() {\n    return this.getDebits().filter(entry => entry.isTrade()).map(entry => ({\n      credit: entry.pair,\n      debit: entry,\n    }));\n  }\n\n  /**\n   * Test whether all debits in this transaction are balanced.\n   */\n  isBalanced() {\n    return allBalanced(this.getDebits());\n  }\n\n  makeBalancedPair(shortcut, isCredit, leadingSymbolMap) {\n    const tokens = Entry.tokenizeShortcut(shortcut, leadingSymbolMap);\n    const accountShortcut = tokens.join(' ');\n    const noAccountShortcut = tokens.slice(0, 2).join(' '); // strip the account and comment, if any\n\n    let credit;\n    let debit;\n    if (isCredit) {\n      credit = new Credit({ shortcut: noAccountShortcut, transaction: this });\n      debit = new Debit({ shortcut: accountShortcut, transaction: this });\n      credit.setPair(debit, false);\n    } else {\n      credit = new Credit({ shortcut: accountShortcut, transaction: this });\n      debit = new Debit({ shortcut: noAccountShortcut, transaction: this });\n      debit.setPair(credit, false);\n    }\n    return { credit, debit };\n  }\n\n  makeBalancedPairs(rawArray, isCredit, leadingSymbolMap = SYMBOL_MAP) {\n    return rawArray.map(shortcut => this.makeBalancedPair(shortcut, isCredit, leadingSymbolMap));\n  }\n\n  makeTrades(rawArray, leadingSymbolMap = SYMBOL_MAP) {\n    return rawArray.map((shortcut) => {\n      const pair = Entry.shortcutToEntries(shortcut, this, leadingSymbolMap);\n      if (pair.length !== 2) {\n        throw makeError(\n          TypeError,\n          ERRORS.INVALID_TERM,\n          `Invalid trade: ${shortcut}`\n        );\n      }\n      return pairToObject(pair);\n    });\n  }\n\n  /**\n   * Apply a function to all entries.\n   * @param {Function} function to apply\n   * @return {Array} result of function application\n   */\n  map(fn) {\n    if (!fn) {\n      return this.entries;\n    }\n    return this.entries.map(fn);\n  }\n\n  size() {\n    return this.entries.length;\n  }\n\n  /**\n   * Get a representation of this object useful for logging or converting to yaml\n   * @param {Object} options \"byDay\", \"yaml\", \"shallow\"\n   * @return {Object<String, *>}\n   */\n  toObject(options = {}) {\n    const trades = this.getTradePairs().map(pair => ({\n      credit: pair.credit.toObject(options),\n      debit: pair.debit.toObject(options),\n    }));\n    return utils.stripFalsy({\n      id: this.id,\n      note: this.note,\n      account: this.account,\n      status: this.status,\n      utc: options.byDay ? this.utc.format('YYYY-MM-DD') : this.utc.toISOString(),\n      address: this.address,\n      party: this.party,\n      tags: this.tags,\n      credits: this.getCredits().map(t => t.toObject(options)),\n      debits: this.getDebits().map(t => t.toObject(options)),\n      trades,\n      fees: this.fees, // change to this.fees.map(f => t.toObject()) when unstub\n      details: this.details,\n    });\n  }\n\n  toString() {\n    return `Transaction: ${this.account} ${this.utc.toISOString} [${this.entries.length} entries]`;\n  }\n\n  /**\n   * Convert a transaction object to its yaml representation\n   * @param {Boolean} byDay if bucketed\n   * @return {String} YAML representation\n   */\n  toYaml(byDay) {\n    const data = this.toObject({ byDay });\n    const work = [];\n    const trades = this.getTradePairs();\n    const credits = this.getCredits().filter(entry => !entry.isTrade());\n    const debits = this.getDebits().filter(entry => !entry.isTrade());\n\n    KEYS.forEach((key) => {\n      if (R.has(key, data)) {\n        const prefix = work.length === 0 ? '-' : ' ';\n        const val = data[key];\n        if (key === 'credits' || key === 'debits') {\n          const entries = (key === 'credits' ? credits : debits);\n\n          if (entries && entries.length > 0) {\n            work.push(`${prefix} ${key}:`);\n            entries.forEach((entry) => {\n              try {\n                work.push(`    - ${entry.getFullShortcut(this)}`);\n              } catch (e) {\n                throw new Error(`Not a ${key}: ${JSON.stringify(entry)} ${typeof entry}`);\n              }\n            });\n          }\n        } else if (key === 'trades') {\n          if (trades && trades.length > 0) {\n            work.push(`${prefix} ${key}:`);\n            trades.forEach((entry) => {\n              try {\n                work.push(`    - ${entry.debit.getFullShortcut(this)}`);\n              } catch (e) {\n                throw new Error(`Not a trade: ${JSON.stringify(entry)}`);\n              }\n            });\n          }\n        } else if (key === 'tags') {\n          if (val && val.length > 0) {\n            work.push(`${prefix} tags:`);\n            val.forEach((tag) => {\n              work.push(`    - ${tag}`);\n            });\n          }\n        } else if (key === 'account') {\n          work.push(`${prefix} account: ${val.credit}`);\n        } else {\n          work.push(`${prefix} ${key}: ${val}`);\n        }\n      }\n    });\n    work.push('');\n    return work.join('\\n');\n  }\n}\n\nmodule.exports = Transaction;\n"
  ]
}
